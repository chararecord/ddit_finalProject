<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.prof.lectBoard.dao.LectureBoardDAO">

	<resultMap type="LectureVO" id="lectureMap" autoMapping="true">
		<id property="lectId" column="LECT_ID" />
		<association property="usrVO" javaType="UsrVO" autoMapping="true" />
		<association property="subMajorVO" javaType="SubMajorVO" autoMapping="true" />
	</resultMap>
	<!-- 강의 정보 조회 -->
	<select id="selectLectInfo" parameterType="String" resultMap="lectureMap" >
		SELECT A.USER_NM
		    , A.USER_PHONE
		    , A.USER_EMAIL
		    , C.MAJOR_NM
		    , D.COLL_NM
		    , E.SUBJECT_NM
		    , ( SELECT COMM_DESC
		        FROM COMM
		        WHERE COMM.COMM_ID = E.ESTA_SUB
		        ) AS ESTA_SUB
		    , F.SEME_YEAR
		    , F.SEME
		    , I.LECT_ID
		    , I.LECT_NM
		    , I.CAM_YEAR
		    , I.CREDIT
		FROM USR A INNER JOIN PROFESSOR B ON A.USER_ID = B.PROF_ID
		            INNER JOIN MAJOR C ON B.MAJOR_ID = C.MAJOR_ID
		            INNER JOIN COLL D ON C.COLL_ID = D.COLL_ID
		            INNER JOIN SUB_MAJOR E ON C.MAJOR_ID = E.MAJOR_ID
		            INNER JOIN SEMESTER F ON E.SEME_ID = F.SEME_ID
		            INNER JOIN SYLLABUS G ON B.PROF_ID = G.PROF_ID
		            INNER JOIN SYLLA_APPR H ON G.SYLLA_ID = H.SYLLA_ID
		            INNER JOIN LECTURE I ON H.SYLLA_APPR_ID = I.SYLLA_APPR_ID
		WHERE I.LECT_ID = #{lectId}
	</select>
	
	<!-- 게시판 내 전체 게시글 개수 조회하는 SELECT문 -->
	<select id="selectTotalRecord" parameterType="PagingVO" resultType="int">
		SELECT COUNT(*)
		FROM LECT_NOTI
	</select>
	
	<!-- 강의 게시판 게시글 조회 SELECT문 -->
	<select id="selectLectNoticeList" parameterType="PagingVO" resultType="LectNotiVO">
		WITH ORDEREDLECTNOTI AS (
		    SELECT LECT_NOTI_ID, LECT_ID, TIT, CONT, WR_DATE, HIT
		            , (
		                SELECT COUNT(ATTA_SN)
		                FROM ATTA_FILE
		                WHERE ATTA_FILE.ATTA_ID = LECT_NOTI.LECT_NOTI_ID
		            ) AS ATTA_COUNT
		    FROM LECT_NOTI
		    ORDER BY LECT_NOTI_ID 
		)
		SELECT  B.* FROM (
		    SELECT ROWNUM RNUM2, A.*
		    FROM (
		            SELECT ROWNUM RNUM, ORDEREDLECTNOTI.*
		            FROM ORDEREDLECTNOTI ORDER BY LECT_NOTI_ID DESC
		    ) A
		) B
		WHERE RNUM2 BETWEEN #{startRow} AND #{endRow}
	</select>
</mapper>